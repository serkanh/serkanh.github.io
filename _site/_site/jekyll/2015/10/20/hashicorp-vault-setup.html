<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="/stylesheets/stylesheet.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="/stylesheets/pygment_trac.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="/stylesheets/print.css" media="print" />

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title> Quickstart with Vault </title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1> Serkan Haytac </h1>
        <h2></h2>
        <a href="https://github.com/pietromenna/jekyll-architect-theme" class="button"><small>View project on</small> GitHub</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          
          <h2>Quickstart with Vault</h2>
<p class="meta">20 Oct 2015</p>

<p>Vault is a secure storage server that secures, stores, passwords, tokens, API keys etc. It is the from Hashicorp which had some great products such as Vault, Terraform and i think the most popular of all Vagrant.
&quot;Vault handles leasing, key revocation, key rolling, and auditing. I want to give a simple to follow setup example for anyone to try out this awesome tool. </p>

<h5>1. Start the server</h5>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"> 
vault server -config<span class="o">=</span>vault.hcl </code></pre></figure>
 
<div class="highlight"><pre><code class="language-" data-lang="">#vault.hcl
backend "file" {
  path="vault"
}

listener "tcp" {
  tls_disable = 1 
  address="127.0.0.1:8200"
}

disable_mlock = true
</code></pre></div>
<h5>2. Initiate vault and copy/save root token and the keys. *<em>This is only done when initating a new server.</em></h5>
<div class="highlight"><pre><code class="language-" data-lang="">VAULT_ADDR=http://127.0.0.1:8200 vault init 
</code></pre></div>
<h5>3. Authenticate with master token.</h5>
<div class="highlight"><pre><code class="language-" data-lang="">VAULT_ADDR=http://127.0.0.1:8200 vault auth &lt;root-token&gt;
</code></pre></div>
<h5>4. Unseal to add new authentication tokens. Default threshold is set to 3. Only root token can unseal the vault. Vault is sealed everytime it is restarted and has to be unsealed for services to acces</h5>
<div class="highlight"><pre><code class="language-" data-lang="">VAULT_ADDR=http://127.0.0.1:8200 vault unseal  
</code></pre></div>
<h5>5. Create a policy.</h5>
<div class="highlight"><pre><code class="language-" data-lang="">VAULT_ADDR=http://127.0.0.1:8200 vault policy-write secret acl.hcl
</code></pre></div><div class="highlight"><pre><code class="language-" data-lang="">#acl.hcl
path "secret/*" {
  policy = "read"
}


path "auth/token/lookup-self" {
  policy = "read"
}
</code></pre></div>
<h5>6. Create a token that services will be using with the previously created policy. Token generated will be used for services so make a copy of it.</h5>
<div class="highlight"><pre><code class="language-" data-lang="">VAULT_ADDR=http://127.0.0.1:8200 vault token-create -policy="secret"   
</code></pre></div>
<h5>7. While still in root and add new key/values</h5>
<div class="highlight"><pre><code class="language-" data-lang="">VAULT_ADDR=http://127.0.0.1:8200 vault write secret/AWS_SECRET_KEY value=&lt;key goes here&gt;
</code></pre></div>
<h5>8. Authenticate with service token that was generated on step 6 and read the key entered.</h5>



        </section>

        <aside id="sidebar">

          <p class="repo-owner"><a href="https://github.com/jasonlong/architect-theme">architect-theme</a> is maintained by <a href="https://github.com/jasonlong">jasonlong</a>.</p>

          <p class="repo-owner"><a href="https://github.com/pietromenna/jekyll-architect-theme">jekyll-architect-theme</a> is maintained by <a href="https://github.com/pietromenna">pietromenna</a>.</p>

          <p>This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the Architect theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.</p>
        </aside>
      </div>
    </div>

  </body>
</html>
